/** @param {string} [crime] */
function commitCrime(crime) {
  const buttons = [...document.querySelectorAll('button')];
  const cancelCrimeButton = buttons.find(
    button => button.textContent === 'Cancel crime'
  );
  if (cancelCrimeButton === undefined) {
    // Remove popup.
    const popupElement = document.querySelector('.MuiBackdrop-root');
    if (popupElement !== null) {
      const handler = Object.keys(popupElement)[1];
      popupElement[handler].onClick({ isTrusted: true });
    }

    // Commit crime.
    const crimeButton =
      crime !== undefined
        ? buttons.find(button => button.textContent.startsWith(crime))
        : buttons // If crime is undefined, get the crime with the highest chance of success that is not 100%
            .filter(
              button =>
                button.textContent.includes('chance of success') &&
                !button.textContent.includes('100.00%')
            )
            .reduce((a, b) => {
              if (a === undefined) return b;
              const getPercent = button =>
                parseFloat(button.textContent.match(/[0-9]+.[0-9]+%/)[0]);
              const percentA = getPercent(a);
              const percentB = getPercent(b);
              return percentA > percentB ? a : b;
            });
    if (crimeButton === undefined) return;
    const handler = Object.keys(crimeButton)[1];
    crimeButton[handler].onClick({ isTrusted: true });
  }
  setTimeout(() => commitCrime(crime), 1000);
}
commitCrime();
